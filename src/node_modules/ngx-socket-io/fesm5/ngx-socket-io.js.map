{"version":3,"file":"ngx-socket-io.js","sources":["ng://ngx-socket-io/src/socket-io.service.ts","ng://ngx-socket-io/src/socket-io.module.ts"],"sourcesContent":["import { Inject } from '@angular/core';\r\nimport { Observable } from 'rxjs';\r\nimport { share } from 'rxjs/operators';\r\n\r\nimport * as io from 'socket.io-client';\r\n\r\nimport { SocketIoConfig } from './config/socket-io.config';\r\n\r\nexport class WrappedSocket {\r\n    subscribersCounter: Record<string, number> = {};\r\n    eventObservables$: Record<string, Observable<any>> = {};\r\n    ioSocket: any;\r\n    emptyConfig: SocketIoConfig = {\r\n        url: '',\r\n        options: {}\r\n    };\r\n\r\n    constructor(private config: SocketIoConfig) {\r\n        if (config === undefined) {\r\n            config = this.emptyConfig;\r\n        }\r\n        const url: string = config.url;\r\n        const options: any = config.options;\r\n        const ioFunc = (io as any).default ? (io as any).default : io;\r\n        this.ioSocket = ioFunc(url, options);\r\n    }\r\n\r\n    of(namespace: string) {\r\n        this.ioSocket.of(namespace);\r\n    }\r\n\r\n    on(eventName: string, callback: Function) {\r\n        this.ioSocket.on(eventName, callback);\r\n    }\r\n\r\n    once(eventName: string, callback: Function) {\r\n        this.ioSocket.once(eventName, callback);\r\n    }\r\n\r\n    connect() {\r\n        return this.ioSocket.connect();\r\n    }\r\n\r\n    disconnect(close?: any) {\r\n        return this.ioSocket.disconnect.apply(this.ioSocket, arguments);\r\n    }\r\n\r\n    emit(eventName: string, ...args: any[]) {\r\n        return this.ioSocket.emit.apply(this.ioSocket, arguments);\r\n    }\r\n\r\n    removeListener(eventName: string, callback?: Function) {\r\n        return this.ioSocket.removeListener.apply(this.ioSocket, arguments);\r\n    }\r\n\r\n    removeAllListeners(eventName?: string) {\r\n        return this.ioSocket.removeAllListeners.apply(this.ioSocket, arguments);\r\n    }\r\n\r\n    fromEvent<T>(eventName: string): Observable<T> {\r\n        if (!this.subscribersCounter[eventName]) {\r\n            this.subscribersCounter[eventName] = 0;\r\n        }\r\n        this.subscribersCounter[eventName]++;\r\n\r\n        if (!this.eventObservables$[eventName]) {\r\n            this.eventObservables$[eventName] = new Observable((observer: any) => {\r\n                const listener = (data: T) => {\r\n                    observer.next(data);\r\n                };\r\n                 this.ioSocket.on(eventName, listener);\r\n                 return () => {\r\n                     this.subscribersCounter[eventName]--;\r\n                     if (this.subscribersCounter[eventName] === 0) {\r\n                        this.ioSocket.removeListener(eventName, listener);\r\n                        delete this.eventObservables$[eventName];\r\n                     }\r\n                };\r\n            }).pipe(\r\n                share()\r\n            );\r\n        }\r\n        return this.eventObservables$[eventName];\r\n    }\r\n\r\n    fromOneTimeEvent<T>(eventName: string): Promise<T> {\r\n        return new Promise<T>(resolve => this.once(eventName, resolve));\r\n    }\r\n\r\n}\r\n","import { NgModule, ModuleWithProviders, InjectionToken } from '@angular/core';\r\nimport { SocketIoConfig } from './config/socket-io.config';\r\nimport { WrappedSocket } from './socket-io.service';\r\n\r\n/** Socket factory */\r\nexport function SocketFactory(config: SocketIoConfig) {\r\n    return new WrappedSocket(config);\r\n}\r\n\r\nexport const SOCKET_CONFIG_TOKEN = new InjectionToken<SocketIoConfig>('__SOCKET_IO_CONFIG__');\r\n\r\n@NgModule({})\r\nexport class SocketIoModule {\r\n    static forRoot(config: SocketIoConfig): ModuleWithProviders<SocketIoModule> {\r\n        return {\r\n            ngModule: SocketIoModule,\r\n            providers: [\r\n                { provide: SOCKET_CONFIG_TOKEN, useValue: config },\r\n                {\r\n                    provide: WrappedSocket,\r\n                    useFactory: SocketFactory,\r\n                    deps : [SOCKET_CONFIG_TOKEN]\r\n                }\r\n            ]\r\n        };\r\n    }\r\n }\r\n"],"names":["io.default"],"mappings":"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"}